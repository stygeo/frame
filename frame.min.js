(function(h){function n(a){Object.defineProperty(a,"default",{get:function(){this.__sharedInstance||(this.__sharedInstance=new a);return this.__sharedInstance},set:function(){}})}function e(a){var b={};-1!=a.indexOf(" ")?(b.event=a.substr(0,a.indexOf(" ")),b.selector=a.substr(a.indexOf(" ")+1)):b.event=a;return b}function d(a){a=a.onReady;if(f.config.db){var b=f.config.db;if("Frame.IndexedStore"===b.type){var c=new f.IndexedStore;f.defaultStore=c;f.defaultStore.definition=b.definition;c.open(b.name,
a,b)}}else a()}var g={},k,s=0;k=function(a,b){return g.hasOwnProperty.call(a,b)};var u=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b},v=function(a){a instanceof Array||(a=[a]);return a},w=function(a){var b=(++s).toString();a&&(b=a+"-"+b);return b};h.history.originalPushState=h.history.pushState;h.history.pushState=function(a){var b=h.history.originalPushState.apply(h.history,arguments);$(h).trigger("pushstate",a);return b};String.prototype.pluralize=function(){return"s"===
this[this.length-1]?this:this+"s"};String.prototype.singularize=function(){return"s"===this[this.length-1]?this.substr(0,this.length-1):this};String.prototype.camelCase=function(){return this.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})};var B=function(a,b){function c(){return a.apply(this,b)}c.prototype=a.prototype;return new c},p={events:function(a){void 0===this._events&&(this._events={});return void 0!==a?(void 0===this._events[a]&&(this._events[a]=[]),this._events[a]):
this._events},on:function(a,b,c){this.events(a).push({callback:b,scope:c});return this},off:function(a,b){if(void 0===b)this.events(a).length=0;else if("function"===typeof b)for(var c=0;c<this.events(a).length;c++){var e=this.events(a)[c];if(e.callback===b){this.events(a).splice(c,1);break}}else if("object"===typeof b){var d=this._events;if("for"in b&&b.for)for(a in d)for(var f=d[a],c=0;c<f.length;c++)"object"===typeof f[c].scope&&(f.splice(c,1),c=0);else if("all"in b&&b.all)for(a in d){for(var g=
[],f=d[a],c=0;c<f.length;c++)e=f[c],"object"===typeof e.scope&&g.push(e);for(c=0;c<g.length;c++)d[a].splice(d[a].indexOf(g[c]),1)}}},trigger:function(a,b){var c=new CustomEvent(a);c.customData=b;for(var e=this.events(a),d=0;d<e.length;d++){var f=e[d];void 0!==f&&f.callback.call(f.scope||this,c,b)}}},m=function(){};m.extend=function(a,b){var c=this,e;a instanceof Array||(b=a);e=b&&k(b,"constructor")?b.constructor:function(){return c.apply(this,arguments)};var d=function(){this.constructor=e};d.prototype=
c.prototype;e.prototype=new d;b&&_.extend(e.prototype,b);for(var f in c)k(c,f)&&(e[f]=c[f]);e.__super__=c.prototype;return e};var l=m.extend({constructor:function(a){this.gid=w();this.serialize(a)},properties:function(){return this._properties||(this._properties={})},setProperty:function(a,b,c){var e=!this.properties()[a];this.properties()[a]=b;e&&this.trigger(""+a+":new");this.trigger(""+a+":change");(!c||c&&!c.noChangeTrigger)&&this.trigger("change",new q(a))},getProperty:function(a){return this.properties()[a]},
valueForKey:function(a,b,c){if(void 0===b)return this.getProperty(a);this.setProperty(b,a,c)},serialize:function(a){var b=this.constructor,c;for(c in a)c in b||b.property(c),this.valueForKey(a[c],c,{noChangeTrigger:!0});a&&this.trigger("change",new q(u(a)))},toJSON:function(){var a={},b;for(b in this.properties())this.properties().hasOwnProperty(b)&&(a[b]=this.valueForKey(b));return a}});_.extend(l,p);_.extend(l.prototype,p);l.property=function(a){a=v(a);for(var b=0;b<a.length;b++){var c=a[b];a in
this.prototype||Object.defineProperty(this.prototype,c,{enumerable:!0,get:function(){return this.getProperty(c)},set:function(a){this.setProperty(c,a)}})}};var t=[],m={forEach:t.forEach,push:function(a){t.push.call(this,a);this.trigger("change",a)},clear:function(a){this.length=0;if(void 0!==a){for(var b=0;b<a.length;b++)t.push.call(this,a[b]);this.trigger("reset",this)}return this},reset:function(a){return this.clear(a)},each:function(a,b){for(var c=0;c<this.length;c++)a.call(b||this,this[c],c)}},
q=function(a){var b;b=a instanceof Array?a:Array.prototype.slice.call(arguments,0);0<b.length&&t.push.apply(this,b)};q.prototype=[];_.extend(q.prototype,m);_.extend(q.prototype,l.prototype);_.extend(q.prototype,p);m=l.extend({constructor:function(a,b){l.call(this,a);this.isNew=!0},fetch:function(a,b){b||(b={});f.defaultStore.fetch(this,a,b)},save:function(a){a||(a={});this.isNew?f.defaultStore.add(this,a):f.defaultStore.update(this,a)},destroy:function(a){f.defaultStore.destroy(this,a)},sync:function(a){a=
a||{};f.defaultStore.sync(this,a)},__validateModel:function(){if(!this.url)throw"No URL specified for model";}});m.find=function(a,b){f.defaultStore.find(this,a,b)};m.all=function(a,b){f.defaultStore.all(a,this,b)};var x=l.extend({on:function(a,b,c){l.on.call(this,a,c,b)},off:function(a,b){l.off.call(this,a,{for:b})}});n(x);var y=l.extend({constructor:function(a){l.call(this);this.scope=a;this.routes=[];this.boundPopstate=_.bind(this.popstate,this);this.enable()},go:function(a,b){h.history.pushState(null,
b||h.document.title,a)},popstate:function(a){a=this.hash();for(var b=0;b<this.routes.length;b++)this.testRoute(a,this.routes[b])},testRoute:function(a,b){var c;return(c=b.matcher.regexp.exec(a))?(b.callback&&this.enabled&&b.callback.apply(this.scope,c.slice(1,c.length)),!0):!1},generateMatcher:function(a){parts=a.split("/");matcher=[];for(a=variables=0;a<parts.length;a++){var b=parts[a];/:.*/.test(b)?(matcher.push("([A-Za-z0-9_-]*)"),variables++):matcher.push(b)}return{variables:variables,regexp:RegExp(matcher.join("/"))}},
getPathName:function(){return h.location.pathname},hash:function(){var a=this.getPathName();return void 0===a?"":a},route:function(a,b){a={matcher:this.generateMatcher(a),callback:b};this.routes.push(a);this.testRoute(this.hash(),a)},disable:function(){this.enabled=!1;$(h).off("popstate",this.boundPopstate);$(h).off("pushstate",this.boundPopstate)},enable:function(){this.enabled=!0;$(h).on("popstate",this.boundPopstate);$(h).on("pushstate",this.boundPopstate)},removeAllRoutes:function(){this.disable();
this.routes=[]}}),r=l.extend({subviews:[],tag:"div",constructor:function(a){a||(a={});l.call(this);this.el=a.el;a.tag&&(this.tag=a.tag);this.cssClass=a.cssClass;if(this.events)for(var b in this.events)if(this.events.hasOwnProperty(b))this.on(b,this[this.events[b]])},addSubview:function(a,b){a.willMoveToSuperview(this);this.subviews.push(a);a.superView=this;a.draw();a.el||this.$.append(a.$)},removeSubview:function(a){var b=this.subviews.indexOf(a);-1!==b&&(a=this.subviews[b],delete this.subviews[b],
a._wasRemovedFromSuperView())},removeFromSuperview:function(){this.superView&&this.superView.removeSubview(this)},on:function(a,b){var c=e(a),d=_.bind(b,this);if(c.selector)this.$.on(c.event,c.selector,d);else this.$.on(c.event,d)},off:function(a,b){if(void 0===a)this.$.off();else{var c=e(a),d=_.bind(b,this);c.selector?this.$.find(c.selector).off(c.event,d):this.$.off(c.event,d)}},_wasRemovedFromSuperView:function(){this.$.remove();this.off();void 0!==this.wasRemovedFromSuperView&&this.wasRemovedFromSuperView()},
willMoveToSuperview:function(){},draw:function(){}});Object.defineProperty(r.prototype,"$",{enumerable:!0,get:function(){this.__collection||(this.__collection=$(this.el||"<"+this.tag+"/>"),this.__collection.data("view",this),this.__collection.addClass(this.cssClass));return this.__collection},set:function(a){var b=this.$;this.__collection=$(a);this.__collection.data("view",this);b.replaceWith(this.__collection)}});var C=r.extend({constructor:function(a,b){b=b||{};f.View.call(this,b);this.model=a;
this.model.on("change",function(a,b){this.update(b)},this)},data:function(){if(this.model)return this.model.toJSON()},draw:function(){this.$=f.renderEngine.render(this.template,this.data())},update:function(a){a.each(function(a){this.$.find("[data-attribute='"+a+"']").text(this.model.valueForKey(a))},this)}}),D=r.extend({tag:"canvas",constructor:function(a){a||(a={});r.call(this,a);this.$.attr({width:a.width,height:a.height});this.context=this.$[0].getContext("2d")}}),E=r.extend({tag:"button",constructor:function(a){a||
(a={});r.call(this,a);"text"in a&&this.text(a.text)},text:function(a){this.text=a;this.draw()},draw:function(){this.$.text(this.text)}}),z=l.extend(["view","viewControllers","parentViewController"],{constructor:function(a){a||(a={});l.call(this);this.el=a.el;this.viewControllers=[]},loadView:function(){this.viewWillLoad();this.view=new r({el:this.el,tag:this.tag});if(this.events)for(var a in this.events)if(this.events.hasOwnProperty(a))this.on(a,this[this.events[a]]);this.viewDidLoad();return this.view},
addChildViewController:function(a){a.parentViewController&&a.removeFromParentViewController();this.viewControllers.push(a);a.parentViewController=this;this.view.addSubview(a.loadView())},removeChildViewController:function(a){var b=this.viewControllers.indexOf(a);-1!=b&&(conttroller.view.removeFromSuperview(),a.parentViewController=null,this.viewControllers.splice(b,1))},removeFromParentViewController:function(){this.parentViewController&&this.parentViewController.removeChildViewController(this)},
on:function(a,b){var c=e(a),d=_.bind(b,this);if(c.selector)this.view.$.on(c.event,c.selector,d);else this.view.$.on(c.event,d)},off:function(a,b){if(void 0===a)this.view.$.off();else{var c=e(a),d=_.bind(b,this);c.selector?this.view.$.find(c.selector).off(c.event,d):this.view.$.off(c.event,d)}},viewDidLoad:function(){},viewWillLoad:function(){}});Object.defineProperty(z.prototype,"router",{enumerable:!0,get:function(){void 0===this._router&&(this._router=new y(this));return this._router}});var F=l.extend({open:function(a,
b,c){},destroy:function(a,b){},fetch:function(a,b,c){},add:function(a,b){},all:function(a,b){}}),G=l.extend({didFinishLoading:function(){throw Error("didFinishLoading was not everwritten by subclass or Frame.Application was used directly as application class.");},willTerminate:function(){}}),A=l.extend({render:function(a,b){},update:function(a,b){}}),H=A.extend({render:function(a,b){return(new EJS({url:a+".ejs"})).render(b)},update:function(){}}),f=function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments,
0));return B(q,a)};f.config={};f.BasicObject=l;f.NotificationCenter=x;f.Model=m;f.Router=y;f.Collection=q;f.EventTarget=p;f.View=r;f.DataView=C;f.CanvasView=D;f.Button=E;f.ViewController=z;f.DataStore=F;f.defaultStore=void 0;f.RenderEngine=A;f.EJSRenderEngine=H;f.renderEngine=void 0;f.Application=G;f.createDefaultInstanceMethodOn=n;f.has=k;f.keys=u;f.makeArray=v;f.isBasicObject=function(a){return k(a,"basicObjectDefined")};f.gid=w;f.VERSION="0.1";Object.defineProperty(f,"application",{set:function(a){var b;
this.applicationInstance=b=new a;d({onReady:function(){b.didFinishLaunching(f);b.rootViewController&&(b.rootViewController.el||(b.rootViewController.el="body"),b.rootViewController.loadView().draw())}});$(h).on("beforeunload",function(){b.willTerminate()})}});h.Frame=f;"function"===typeof define&&define.amd&&define("frame.core",[],function(){return f})})(window);(function(h){if(!("Frame"in h))throw Error("Included frame.rest but Frame is undefined");var n=Frame.DataStore.extend({constructor:function(e,d){Frame.DataStore.call(this);this.baseUrl=e;this.defaultKey=d.key||"id"},fetch:function(e,d,g){g||(g={});var k=this.urlForObject(e),s=g.success;g.data=d;g.success=function(d,g,k){e.serialize(d);e.isNew=!1;s&&s.call(e,d,g,k);e.trigger("fetch")};this.findByQueryWithUrl(d,k,g)},add:function(e,d){d||(d={});var g=this.urlForObject(e),k=d.success;d.data={};d.data[e.resource.singularize()]=
e.toJSON();d.success=function(d,g,h){e.serialize(d);e.isNew=!1;k&&k.call(e,d,g,h)};this.addWithUrl(g,d)},update:function(e,d){d||(d={});var g=this.urlForObject(e),k=d.success;d.data={};d.data[e.resource.singularize()]=e.toJSON();d.success=function(d,g,h){e.serialize(d);k&&k.call(e,d,g,h)};this.updateWithUrl(g,d)},destroy:function(e,d){d||(d={});var g=this.urlForObject(e),k=d.success;d.success=function(d,g,h){k&&k.call(e,d,g,h)};this.destroyWithUrl(g,d)},all:function(e,d,g){g||(g={});var h=this.urlForObject(d),
s=g.success;e=e||new Frame.Collection;g.success=function(g,h,k){for(var n=[],p=0;p<g.length;p++){var m=new d(g[p]);m.isNew=!1;n.push(m)}e.reset(n);s&&s.call(e,e,g,h,k)};this.findAllByQueryWithUrl(h,g)},findAllByQueryWithUrl:function(e,d){this.request("GET",e,d)},addWithUrl:function(e,d){this.request("POST",e,d)},updateWithUrl:function(e,d){this.request("PATCH",e,d)},findByQueryWithUrl:function(e,d,g){this.request("GET",d,g)},destroyWithUrl:function(e,d){this.request("DELETE",e,d)},request:function(e,
d,g){$.ajax(d,{type:e,data:g.data,success:function(d,e,h){g.success&&g.success.call(this,d,e,h)},error:function(d,e,g){console.log("XHR error:",g)},async:"async"in g?g.async:!0})},defaultUrl:function(e,d){var g=[Frame.defaultStore.baseUrl,e.resource];d&&e[Frame.defaultStore.defaultKey]&&g.push(e[Frame.defaultStore.defaultKey]);return g.join("/")},urlForObject:function(e){return e.prototype?this.defaultUrl(e.prototype):e.url?$.isFunction(e.url)?e.url():e.url:this.defaultUrl(e,!0)}});Frame.RestStore=
n;"function"===typeof define&&define.amd&&define("frame.rest",[],function(){return n})})(window);
