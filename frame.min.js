(function(g){function s(a){Object.defineProperty(a,"default",{get:function(){this.__sharedInstance||(this.__sharedInstance=new a);return this.__sharedInstance},set:function(){}})}function c(a){var b={};-1!=a.indexOf(" ")?(b.event=a.substr(0,a.indexOf(" ")),b.selector=a.substr(a.indexOf(" ")+1)):b.event=a;return b}function d(a){a=a.onReady;if(e.config.db){var b=e.config.db;if("Frame.IndexedStore"===b.type){var h=new e.IndexedStore;e.defaultStore=h;e.defaultStore.definition=b.definition;h.open(b.name,
a,b)}}else a()}var f={},l,q=0;l=function(a,b){return f.hasOwnProperty.call(a,b)};var v=function(a){a instanceof Array||(a=[a]);return a},w=function(a){var b=(++q).toString();a&&(b=a+"-"+b);return b};g.history.originalPushState=g.history.pushState;g.history.pushState=function(a){var b=g.history.originalPushState.apply(g.history,arguments);$(g).trigger("pushstate",a);return b};String.prototype.pluralize=function(){return"s"===this[this.length-1]?this:this+"s"};String.prototype.singularize=function(){return"s"===
this[this.length-1]?this.substr(0,this.length-1):this};String.prototype.camelCase=function(){return this.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})};var B=function(a,b){function h(){return a.apply(this,b)}h.prototype=a.prototype;return new h},r={getEvent:function(a){void 0===this._events&&(this._events={});return void 0!==a?(void 0===this._events[a]&&(this._events[a]=[]),this._events[a]):this._events},on:function(a,b,h){this.getEvent(a).push({callback:b,scope:h});return this},
off:function(a,b){if(void 0===b)this.getEvent(a).length=0;else if("function"===typeof b){var h=this.getEvent(a);console.log(h);for(var c=0;c<h.length;c++){var d=h[c];if(d.callback===b){h.splice(c,1);break}}}else if("object"===typeof b)if(h=this._events,"for"in b&&b.for)for(a in h)for(var e=h[a],c=0;c<e.length;c++)"object"===typeof e[c].scope&&(e.splice(c,1),c=0);else if("all"in b&&b.all)for(a in h){for(var f=[],e=h[a],c=0;c<e.length;c++)d=e[c],"object"===typeof d.scope&&f.push(d);for(c=0;c<f.length;c++)h[a].splice(h[a].indexOf(f[c]),
1)}},trigger:function(a,b){var h=new CustomEvent(a);h.customData=b;for(var c=this.getEvent(a),d=0;d<c.length;d++){var e=c[d];void 0!==e&&e.callback.call(e.scope||this,h,b)}}},m=function(){};m.extend=function(a,b){var h=this,c,d;a instanceof Array?d=a:b=a;c=b&&l(b,"constructor")?b.constructor:function(){return h.apply(this,arguments)};var e=function(){this.constructor=c};e.prototype=h.prototype;c.prototype=new e;b&&_.extend(c.prototype,b);for(var f in h)l(h,f)&&(c[f]=h[f]);c.__super__=h.prototype;
d&&c.property(d);return c};var k=m.extend({constructor:function(a){this.gid=w();this.serialize(a)},properties:function(){if(void 0===this._properties){this._properties={};var a=this;this.constructor.properties.forEach(function(b){a._properties[b]=void 0})}return this._properties},setProperty:function(a,b,c){var d=!this.properties()[a];this.properties()[a]=b;d&&this.trigger(""+a+":new");this.trigger(""+a+":change");(!c||c&&!c.noChangeTrigger)&&this.trigger("change",new n(a))},getProperty:function(a){return this.properties()[a]},
valueForKey:function(a,b,c){if(void 0===b)return this.getProperty(a);this.setProperty(b,a,c)},serialize:function(a){var b=this.constructor,c;for(c in a)c in b||b.property(c),this.valueForKey(a[c],c,{noChangeTrigger:!0});a&&this.trigger("change",new n(_.keys(a)))},toJSON:function(){var a={},b;for(b in this.properties())this.properties().hasOwnProperty(b)&&(a[b]=this.valueForKey(b));return a}});_.extend(k,r);_.extend(k.prototype,r);k.property=function(a){a=v(a);this.properties=_.uniq((this.properties||
(this.properties=[])).concat(a));var b=this.prototype;a.forEach(function(a){a in b||Object.defineProperty(b,a,{enumerable:!0,get:function(){return this.getProperty(a)},set:function(b){this.setProperty(a,b)}})})};var t=[],m={forEach:t.forEach,push:function(a){t.push.call(this,a);this.trigger("change",a)},clear:function(a){this.length=0;if(void 0!==a){for(var b=0;b<a.length;b++)t.push.call(this,a[b]);this.trigger("reset",this)}return this},reset:function(a){return this.clear(a)},each:function(a,b){for(var c=
0;c<this.length;c++)a.call(b||this,this[c],c)}},n=function(a){var b;b=a instanceof Array?a:Array.prototype.slice.call(arguments,0);0<b.length&&t.push.apply(this,b)};n.prototype=[];_.extend(n.prototype,m);_.extend(n.prototype,k.prototype);_.extend(n.prototype,r);var u=k.extend({constructor:function(a,b){this.dirtyAttributes=[];k.call(this,a);this.isNew=!0;a&&this.setDirtyAttributes(_.keys(a))},setProperty:function(a,b,c){u.__super__.setProperty.call(this,a,b,c);this.setDirtyAttributes(a)},setDirtyAttributes:function(a){a instanceof
Array?this.dirtyAttributes=this.dirtyAttributes.concat(a):this.dirtyAttributes.push(a);this.dirtyAttributes=_.uniq(this.dirtyAttributes)},fetch:function(a,b){b||(b={});e.defaultStore.fetch(this,a,b)},save:function(a){a||(a={});this.isNew?e.defaultStore.add(this,a):e.defaultStore.update(this,a);this.dirtyAttributes=[]},destroy:function(a){e.defaultStore.destroy(this,a)},sync:function(a){a=a||{};e.defaultStore.sync(this,a)},__validateModel:function(){if(!this.url)throw"No URL specified for model";}});
u.find=function(a,b){e.defaultStore.find(this,a,b)};u.all=function(a,b){e.defaultStore.all(a,this,b)};m=k.extend({on:function(a,b,c){k.on.call(this,a,c,b)},off:function(a,b){k.off.call(this,a,{for:b})}});s(m);var x=k.extend({constructor:function(a){k.call(this);this.scope=a;this.routes=[];this.boundPopstate=_.bind(this.popstate,this);this.enable()},go:function(a,b){g.history.pushState(null,b||g.document.title,a)},popstate:function(a){a=this.hash();for(var b=0;b<this.routes.length;b++)this.testRoute(a,
this.routes[b])},testRoute:function(a,b){var c;return(c=b.matcher.regexp.exec(a))?(b.callback&&this.enabled&&b.callback.apply(this.scope,c.slice(1,c.length)),!0):!1},generateMatcher:function(a){parts=a.split("/");matcher=[];for(a=variables=0;a<parts.length;a++){var b=parts[a];/:.*/.test(b)?(matcher.push("([A-Za-z0-9_-]*)"),variables++):matcher.push(b)}return{variables:variables,regexp:RegExp(matcher.join("/"))}},getPathName:function(){return g.location.pathname},hash:function(){var a=this.getPathName();
return void 0===a?"":a},route:function(a,b){a={matcher:this.generateMatcher(a),callback:b};this.routes.push(a);this.testRoute(this.hash(),a)},disable:function(){this.enabled=!1;$(g).off("popstate",this.boundPopstate);$(g).off("pushstate",this.boundPopstate)},enable:function(){this.enabled=!0;$(g).on("popstate",this.boundPopstate);$(g).on("pushstate",this.boundPopstate)},removeAllRoutes:function(){this.disable();this.routes=[]}}),p=k.extend({subviews:[],tag:"div",constructor:function(a){a||(a={});
k.call(this);this.el=a.el;a.tag&&(this.tag=a.tag);this.cssClass=a.cssClass;if(this.events)for(var b in this.events)if(this.events.hasOwnProperty(b))this.on(b,this[this.events[b]])},addSubview:function(a,b){a.willMoveToSuperview(this);this.subviews.push(a);a.superView=this;a.draw();a.el||this.$.append(a.$)},removeSubview:function(a){var b=this.subviews.indexOf(a);-1!==b&&(a=this.subviews[b],delete this.subviews[b],a._wasRemovedFromSuperView())},removeFromSuperview:function(){this.superView&&this.superView.removeSubview(this)},
on:function(a,b){var d=c(a),e=_.bind(b,this);if(d.selector)this.$.on(d.event,d.selector,e);else this.$.on(d.event,e)},off:function(a,b){if(void 0===a)this.$.off();else{var d=c(a),e=_.bind(b,this);d.selector?this.$.find(d.selector).off(d.event,e):this.$.off(d.event,e)}},_wasRemovedFromSuperView:function(){this.$.remove();this.off();void 0!==this.wasRemovedFromSuperView&&this.wasRemovedFromSuperView()},willMoveToSuperview:function(){},draw:function(){}});Object.defineProperty(p.prototype,"$",{enumerable:!0,
get:function(){this.__collection||(this.__collection=$(this.el||"<"+this.tag+"/>"),this.__collection.data("view",this),this.__collection.addClass(this.cssClass));return this.__collection},set:function(a){var b=this.$;this.__collection=$(a);this.__collection.data("view",this);b.replaceWith(this.__collection)}});var y=p.extend({constructor:function(a,b){b=b||{};e.View.call(this,b);this.model=a},onchange:function(a,b){this.update(b)},data:function(){return this.model.toJSON()},draw:function(){this.$=
e.renderEngine.render(this.template,this.data());this.$.find("input[data-attribute]").on("keyup change",_.bind(function(a){this.sync(a.currentTarget)},this))},sync:function(a){a=$(a);var b;b=a.data("attribute");a=a.is(":checkbox")?a.is(":checked"):a.val();this.model[b]=a},update:function(a){a.each(function(a){this.$.find("[data-attribute='"+a+"']").text(this.model.valueForKey(a))},this)}});Object.defineProperty(y.prototype,"model",{enumerable:!0,set:function(a){this._model&&this._model.off("change",
this.onchange,this);a.on("change",this.onchange,this);this._model=a;this.draw()},get:function(){return this._model}});var C=p.extend({tag:"canvas",constructor:function(a){a||(a={});p.call(this,a);this.$.attr({width:a.width,height:a.height});this.context=this.$[0].getContext("2d")}}),D=p.extend({tag:"button",constructor:function(a){a||(a={});p.call(this,a);"text"in a&&this.text(a.text)},text:function(a){this.text=a;this.draw()},draw:function(){this.$.text(this.text)}}),z=k.extend(["view","viewControllers",
"parentViewController"],{constructor:function(a){a||(a={});k.call(this);this.el=a.el;this.viewControllers=[]},loadView:function(){this.viewWillLoad();this.view=new p({el:this.el,tag:this.tag});if(this.events)for(var a in this.events)if(this.events.hasOwnProperty(a))this.on(a,this[this.events[a]]);this.viewDidLoad();return this.view},addChildViewController:function(a){a.parentViewController&&a.removeFromParentViewController();this.viewControllers.push(a);a.parentViewController=this;this.view.addSubview(a.loadView())},
removeChildViewController:function(a){var b=this.viewControllers.indexOf(a);-1!=b&&(conttroller.view.removeFromSuperview(),a.parentViewController=null,this.viewControllers.splice(b,1))},removeFromParentViewController:function(){this.parentViewController&&this.parentViewController.removeChildViewController(this)},on:function(a,b){var d=c(a),e=_.bind(b,this);if(d.selector)this.view.$.on(d.event,d.selector,e);else this.view.$.on(d.event,e)},off:function(a,b){if(void 0===a)this.view.$.off();else{var d=
c(a),e=_.bind(b,this);d.selector?this.view.$.find(d.selector).off(d.event,e):this.view.$.off(d.event,e)}},viewDidLoad:function(){},viewWillLoad:function(){}});Object.defineProperty(z.prototype,"router",{enumerable:!0,get:function(){void 0===this._router&&(this._router=new x(this));return this._router}});var E=k.extend({open:function(a,b,c){},destroy:function(a,b){},fetch:function(a,b,c){},add:function(a,b){},all:function(a,b){}}),F=k.extend({didFinishLoading:function(){throw Error("didFinishLoading was not everwritten by subclass or Frame.Application was used directly as application class.");
},willTerminate:function(){}}),A=k.extend({render:function(a,b){},update:function(a,b){}}),G=A.extend({render:function(a,b){return(new EJS({url:a+".ejs"})).render(b)},update:function(){}}),e=function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments,0));return B(n,a)};e.config={};e.BasicObject=k;e.NotificationCenter=m;e.Model=u;e.Router=x;e.Collection=n;e.EventTarget=r;e.View=p;e.DataView=y;e.CanvasView=C;e.Button=D;e.ViewController=z;e.DataStore=E;e.defaultStore=void 0;e.RenderEngine=
A;e.EJSRenderEngine=G;e.renderEngine=void 0;e.Application=F;e.createDefaultInstanceMethodOn=s;e.has=l;e.keys=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};e.makeArray=v;e.isBasicObject=function(a){return l(a,"basicObjectDefined")};e.gid=w;e.VERSION="0.1";Object.defineProperty(e,"application",{set:function(a){var b;this.applicationInstance=b=new a;d({onReady:function(){b.didFinishLaunching(e);b.rootViewController&&(b.rootViewController.el||(b.rootViewController.el="body"),
b.rootViewController.loadView().draw())}});$(g).on("beforeunload",function(){b.willTerminate()})}});g.Frame=e;"function"===typeof define&&define.amd&&define("frame.core",[],function(){return e})})(window);(function(g){if(!("Frame"in g))throw Error("Included frame.rest but Frame is undefined");var s=Frame.DataStore.extend({constructor:function(c,d){d||(d={});Frame.DataStore.call(this);this.baseUrl=c;this.defaultKey=d.key||"id";this.requestDataType=d.requestDataType},fetch:function(c,d,f){f||(f={});var l=this.urlForObject(c),q=f.success;f.data=d;f.success=function(d,f,l){c.serialize(d);c.isNew=!1;q&&q.call(c,d,f,l);c.trigger("fetch")};this.findByQueryWithUrl(d,l,f)},add:function(c,d){d||(d={});var f=
this.urlForObject(c),l=d.success;d.data={};d.data[c.resource.singularize()]=c.toJSON();d.success=function(d,f,g){c.serialize(d);c.isNew=!1;l&&l.call(c,d,f,g)};this.addWithUrl(f,d)},update:function(c,d){d||(d={});var f=this.urlForObject(c),l=d.success;d.data={};d.data[c.resource.singularize()]=c.toJSON();d.success=function(d,f,g){c.serialize(d);l&&l.call(c,d,f,g)};this.updateWithUrl(f,d)},destroy:function(c,d){d||(d={});var f=this.urlForObject(c),l=d.success;d.success=function(d,f,g){l&&l.call(c,d,
f,g)};this.destroyWithUrl(f,d)},all:function(c,d,f){f||(f={});var g=this.urlForObject(d),q=f.success;c=c||new Frame.Collection;f.success=function(f,g,l){for(var r=[],m=0;m<f.length;m++){var k=new d(f[m]);k.isNew=!1;r.push(k)}c.reset(r);q&&q.call(c,c,f,g,l)};this.findAllByQueryWithUrl(g,f)},findAllByQueryWithUrl:function(c,d){this.request("GET",c,d)},addWithUrl:function(c,d){this.request("POST",c,d)},updateWithUrl:function(c,d){this.request("PATCH",c,d)},findByQueryWithUrl:function(c,d,f){this.request("GET",
d,f)},destroyWithUrl:function(c,d){this.request("DELETE",c,d)},request:function(c,d,f){$.ajax(d,{type:c,dataType:this.requestDataType||"json",data:f.data,success:function(c,d,g){f.success&&f.success.call(this,c,d,g)},error:function(c,d,f){console.log("XHR error:",f)},async:"async"in f?f.async:!0})},defaultUrl:function(c,d){var f=[Frame.defaultStore.baseUrl,c.resource];d&&c[Frame.defaultStore.defaultKey]&&f.push(c[Frame.defaultStore.defaultKey]);return f.join("/")},urlForObject:function(c){return c.prototype?
this.defaultUrl(c.prototype):c.url?$.isFunction(c.url)?c.url():c.url:this.defaultUrl(c,!0)}});Frame.RestStore=s;"function"===typeof define&&define.amd&&define("frame.rest",[],function(){return s})})(window);
