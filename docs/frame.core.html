<!DOCTYPE html>

<html>
<head>
  <title>frame.core.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>frame.core.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(window) {
  <span class="keyword">var</span> __version = <span class="string">'0.1'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Helper methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> __emptyHash = {}, __has, __extend, __currentGID = <span class="number">0</span>,
  __has = <span class="keyword">function</span>(object, property) { <span class="keyword">return</span> __emptyHash.hasOwnProperty.call(object, property); },
  __keys = <span class="keyword">function</span>(object) {
    <span class="keyword">var</span> keys = []
    <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> object) {
      <span class="keyword">if</span>(object.hasOwnProperty(k)) {
        keys.push(k);
      }
    }
    <span class="keyword">return</span> keys;
  },
  __merge = <span class="keyword">function</span>(hash, otherHash) {
    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> otherHash) {
      <span class="keyword">if</span> (__has(otherHash, key) &amp;&amp; !__has(hash, key)) {
        hash[key] = otherHash[key];
      }
    }
  },
  __makeArray = <span class="keyword">function</span>(object) {
    <span class="keyword">if</span>( !(object <span class="keyword">instanceof</span> Array) ) {
      object = [object];
    }
    <span class="keyword">return</span> object;
  },
  __isBasicObject = <span class="keyword">function</span>(object) {
    <span class="keyword">return</span> __has(object, <span class="string">'basicObjectDefined'</span>);
  },
  __isString = <span class="keyword">function</span>(object) {
    <span class="keyword">return</span> <span class="keyword">typeof</span>(object) == <span class="string">"string"</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Returns a new GID with the given prefix. GIDs are always returned as string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  __gid = <span class="keyword">function</span>(prefix) {
    <span class="keyword">var</span> GID = (++__currentGID).toString();
    <span class="keyword">if</span>(prefix) {
      GID = prefix+<span class="string">"-"</span>+GID;
    }

    <span class="keyword">return</span> GID;
  }

  window.history.originalPushState = window.history.pushState;
  window.history.pushState = <span class="keyword">function</span>(state) {
    <span class="keyword">var</span> r = window.history.originalPushState.apply(window.history, arguments);

    $(window).trigger(<span class="string">'pushstate'</span>, state);

    <span class="keyword">return</span> r;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Inflectors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  String.prototype.pluralize = <span class="keyword">function</span>() {
    <span class="keyword">return</span> (<span class="keyword">this</span>[<span class="keyword">this</span>.length-<span class="number">1</span>] === <span class="string">'s'</span> ? <span class="keyword">this</span> : <span class="keyword">this</span> + <span class="string">'s'</span>);
  }
  String.prototype.singularize = <span class="keyword">function</span>() {
    <span class="keyword">return</span> (<span class="keyword">this</span>[<span class="keyword">this</span>.length-<span class="number">1</span>] === <span class="string">'s'</span> ? <span class="keyword">this</span>.substr(<span class="number">0</span>, <span class="keyword">this</span>.length - <span class="number">1</span>) : <span class="keyword">this</span>);
  }
  String.prototype.camelCase = <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">this</span>.toLowerCase().replace(<span class="regexp">/-(.)/g</span>, <span class="keyword">function</span>(match, group1) {
      <span class="keyword">return</span> group1.toUpperCase();
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Creates a shared instance method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">createDefaultInstanceMethodOn</span><span class="params">(object)</span> {</span>
    Object.defineProperty(object, <span class="string">'default'</span>, {
      get: <span class="keyword">function</span>() {
        <span class="keyword">if</span>(!<span class="keyword">this</span>.__sharedInstance) { <span class="keyword">this</span>.__sharedInstance = <span class="keyword">new</span> object(); }
        <span class="keyword">return</span> <span class="keyword">this</span>.__sharedInstance;
      },
      set: <span class="keyword">function</span>(){}
    });
  }

  __extend = <span class="keyword">function</span>(propertiesOrProtoProps, protoProps) {
    <span class="keyword">var</span> parent = <span class="keyword">this</span>;
    <span class="keyword">var</span> child, properties;
    <span class="keyword">if</span>(propertiesOrProtoProps <span class="keyword">instanceof</span> Array) {
      properties = properties;
    } <span class="keyword">else</span> {
      protoProps = propertiesOrProtoProps;
    }

    <span class="keyword">if</span> (protoProps &amp;&amp; __has(protoProps, <span class="string">'constructor'</span>)) {
      child = protoProps.constructor;
    } <span class="keyword">else</span> {
      child = <span class="keyword">function</span>(){ <span class="keyword">return</span> parent.apply(<span class="keyword">this</span>, arguments); };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Set the prototype chain to inherit from <code>parent</code>, without calling
<code>parent</code>&#39;s constructor function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> Surrogate = <span class="keyword">function</span>() { <span class="keyword">this</span>.constructor = child; };

    Surrogate.prototype = parent.prototype;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Copy over static methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    child.prototype = <span class="keyword">new</span> Surrogate;

    <span class="keyword">if</span> (protoProps) _.extend(child.prototype, protoProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Copy over static methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> parent) {
      <span class="keyword">if</span> (__has(parent, key)) {
        child[key] = parent[key];
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Set a convenience property in case the parent&#39;s prototype is needed
later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    child.__super__ = parent.prototype;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Set the properties on the object if any was given</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span>(properties) {
      child.property(properties);
    }

    <span class="keyword">return</span> child;
  };

  <span class="keyword">var</span> VariableConstructor = <span class="keyword">function</span>(constructor, args) {
    <span class="function"><span class="keyword">function</span> <span class="title">F</span><span class="params">()</span> {</span>
      <span class="keyword">return</span> constructor.apply(<span class="keyword">this</span>, args);
    }
    F.prototype = constructor.prototype;

    <span class="keyword">return</span> <span class="keyword">new</span> F();
  };

  <span class="comment">/* Basic event target */</span>
  <span class="keyword">var</span> EventTarget = {
    events: <span class="keyword">function</span>(event) {
      <span class="keyword">if</span>(<span class="keyword">this</span>._events === <span class="literal">undefined</span>) <span class="keyword">this</span>._events = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Return the event property or return the event list based on the argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(event !== <span class="literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Set a default array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span>(<span class="keyword">this</span>._events[event] === <span class="literal">undefined</span>) <span class="keyword">this</span>._events[event] = [];

        <span class="keyword">return</span> <span class="keyword">this</span>._events[event];
      }
      <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>._events;
    },

    <span class="comment">/*
     * On (event)
     * event: the event
     * callback: callback to invoke upon 'trigger'
     * scope: object used for 'call' method.
     */</span>
    on: <span class="keyword">function</span>(event, callback, scope) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Push the callback to the event stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> eventListeners = <span class="keyword">this</span>.events(event);
      eventListeners.push({callback: callback, scope: scope});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Return the collection so we may chain</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> <span class="keyword">this</span>;
    },
    off: <span class="keyword">function</span>(event, callback) {
      <span class="keyword">if</span>(callback === <span class="literal">undefined</span>) {
        <span class="keyword">this</span>.events(event).length = <span class="number">0</span>;
      } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> callback === <span class="string">'function'</span>) {
        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.events(event).length; i++) {
          <span class="keyword">var</span> v = <span class="keyword">this</span>.events(event)[i];
          <span class="keyword">if</span>(v.callback === callback) {
            <span class="keyword">this</span>.events(event).splice(i, <span class="number">1</span>);
            <span class="keyword">break</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>If callback is object it&#39;s an key value hash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> callback === <span class="string">'object'</span>) {
        <span class="keyword">var</span> object = event,
            options = callback,
            events = <span class="keyword">this</span>._events;

        <span class="keyword">if</span>(<span class="string">'for'</span> <span class="keyword">in</span> options &amp;&amp; options.<span class="keyword">for</span>) {
          <span class="keyword">for</span>(<span class="keyword">var</span> event <span class="keyword">in</span> events) {
            <span class="keyword">var</span> observers = events[event];

            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; observers.length; i++) {
              <span class="keyword">var</span> observer = observers[i];

              <span class="keyword">if</span>(<span class="keyword">typeof</span> observer.scope === <span class="string">'object'</span>) {
                observers.splice(i, <span class="number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Restart the loop, because the index has changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                i = <span class="number">0</span>;
              }
            }
          }
        }

        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">'all'</span> <span class="keyword">in</span> options &amp;&amp; options.all) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Find all observers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">for</span>(<span class="keyword">var</span> event <span class="keyword">in</span> events) {
            <span class="keyword">var</span> allObservers = [];
            <span class="keyword">var</span> observers = events[event];</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Loop over each observer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; observers.length; i++) {
              <span class="keyword">var</span> v = observers[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>The event must be an object of some sort</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="keyword">if</span>(<span class="keyword">typeof</span> v.scope === <span class="string">'object'</span>) {allObservers.push(v);}
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Remove the observers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; allObservers.length; i++) {
              events[event].splice(events[event].indexOf(allObservers[i]), <span class="number">1</span>);
            }
          }

        }
      }
    },

    <span class="comment">/*
     * Trigger (event)
     * Trigger a specific event
     * event: event you'd like to trigger
     */</span>
    trigger: <span class="keyword">function</span>(event, data) {
      <span class="keyword">var</span> customEvent = <span class="keyword">new</span> CustomEvent(event);
      customEvent.customData = data;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Loop over each event-callback and invoke the callback (w/ optionally the scope)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> events = <span class="keyword">this</span>.events(event);
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; events.length; i++) {
        <span class="keyword">var</span> v = events[i]

        <span class="keyword">if</span>(v !== <span class="literal">undefined</span>) v.callback.call(v.scope || <span class="keyword">this</span>, customEvent, data);
      }
    },
  };

  <span class="keyword">var</span> Construct = <span class="keyword">function</span>(){};
  Construct.extend = __extend;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Basic low level object. Contains most low level object functions such as KVO &amp; KVC.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> BasicObject = Construct.extend({
    constructor: <span class="keyword">function</span>(attributes) {
      <span class="comment">/* These values are not meant to be KVO. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Determines whether this object is a basic object so you can distinguish them from regular objects.
this.basicObjectDefined=true
The current id of the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.gid = __gid();</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Serialize the attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.serialize(attributes);
    },

    properties: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>._properties || (<span class="keyword">this</span>._properties = {})
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Specialized setter. Calls callbacks on observed values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setProperty: <span class="keyword">function</span>(key, value) {
      <span class="keyword">var</span> isNew = !<span class="keyword">this</span>.properties()[key];

      <span class="keyword">this</span>.properties()[key] = value

      <span class="keyword">if</span>(isNew) { <span class="keyword">this</span>.trigger(<span class="string">""</span> + key + <span class="string">":new"</span>); }

      <span class="keyword">this</span>.trigger(<span class="string">""</span> + key + <span class="string">":change"</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Basic object getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getProperty: <span class="keyword">function</span>(key) {
      <span class="keyword">return</span> <span class="keyword">this</span>.properties()[key]
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Returns the given or sets the given key with value (Key Value Coding, KVC)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    valueForKey: <span class="keyword">function</span>(value_or_key, key) {
      <span class="keyword">if</span>(key === <span class="literal">undefined</span>) {
        <span class="keyword">return</span> <span class="keyword">this</span>.getProperty(value_or_key)
      }

      <span class="keyword">this</span>.setProperty(key, value_or_key)
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Serialization of attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    serialize: <span class="keyword">function</span>(serializableAttributes) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Get the current object&#39;s constructor so we can bind values to it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> objectClass = <span class="keyword">this</span>.constructor;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Iterate over the retrieved attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> serializableAttributes) {
        <span class="keyword">if</span>(!(key <span class="keyword">in</span> objectClass)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Model attributes are &#39;lazily&#39; added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          objectClass.property(key);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Assign the attributes value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.valueForKey(serializableAttributes[key], key);
      }
    },
  });
  _.extend(BasicObject, EventTarget);
  _.extend(BasicObject.prototype, EventTarget);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Public property setter. Creates specialized properties which can be accessed through KVC and make use of KVO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  BasicObject.property = <span class="keyword">function</span>(propertyNames) {
    propertyNames = __makeArray(propertyNames);

    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; propertyNames.length; i++) {
      <span class="keyword">var</span> propertyName = propertyNames[i];

      <span class="keyword">if</span>( !(propertyNames <span class="keyword">in</span> <span class="keyword">this</span>.prototype) ) {
        Object.defineProperty(<span class="keyword">this</span>.prototype, propertyName, {
          enumerable: <span class="literal">true</span>,
          get: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>.getProperty(propertyName)
          },
          set: <span class="keyword">function</span>(value) {
            <span class="keyword">this</span>.setProperty(propertyName, value)
          }
        });
      }
    }
  }

  <span class="comment">/*
   * Frame.Model data object.
   */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>The basic model. Inherit from this object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Model = BasicObject.extend({
    constructor: <span class="keyword">function</span>(attributes, options) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Call the basic object&#39;s constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      BasicObject.call(<span class="keyword">this</span>, attributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Define this as a new model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.isNew = <span class="literal">true</span>;
    },

    fetch: <span class="keyword">function</span>(parameters, options) {
      <span class="keyword">if</span>(!options) options = {};

      Frame.defaultStore.fetch(<span class="keyword">this</span>, parameters, options);
    },

    save: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span>(!options) options = {};

      <span class="keyword">if</span>(<span class="keyword">this</span>.isNew) {
        Frame.defaultStore.add(<span class="keyword">this</span>, options);
      } <span class="keyword">else</span> {
        Frame.defaultStore.update(<span class="keyword">this</span>, options);
      }
    },

    destroy: <span class="keyword">function</span>(options) {
      Frame.defaultStore.destroy(<span class="keyword">this</span>, options);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Copies the attributes of the model to a new object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: <span class="keyword">function</span>() {
      <span class="keyword">var</span> attributes = {};

      <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> <span class="keyword">this</span>.properties()) {
        <span class="keyword">if</span>(<span class="keyword">this</span>.properties().hasOwnProperty(k)) {
          attributes[k] = <span class="keyword">this</span>.valueForKey(k);
        }
      }

      <span class="keyword">return</span> attributes;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Sync the object with the server. (Only used by SocketStore)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sync: <span class="keyword">function</span>(options) {
      options = options || {};

      Frame.defaultStore.sync(<span class="keyword">this</span>, options);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Validates the model (not the model&#39;s fields), such as URL.
TODO move this to the datastore instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    __validateModel: <span class="keyword">function</span>(){
      <span class="keyword">if</span>(!<span class="keyword">this</span>.url) <span class="keyword">throw</span> <span class="string">"No URL specified for model"</span>;
    },
  });
  Model.find = <span class="keyword">function</span>(idOrQuery, options) {
    Frame.defaultStore.find(<span class="keyword">this</span>, idOrQuery, options);
  };
  Model.all = <span class="keyword">function</span>(collection, options) {
    Frame.defaultStore.all(collection, <span class="keyword">this</span>, options);
  };

  <span class="keyword">var</span> NotificationCenter = BasicObject.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Overwrite on and off to ensure certain variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    on: <span class="keyword">function</span>(event, object, method) {

      BasicObject.on.call(<span class="keyword">this</span>, event, method, object);
    },

    off: <span class="keyword">function</span>(event, object) {
      BasicObject.off.call(<span class="keyword">this</span>, event, {<span class="keyword">for</span>: object})
    }
  });
  createDefaultInstanceMethodOn(NotificationCenter);

  <span class="comment">/*
   * Routing handler
   */</span>
  <span class="keyword">var</span> Router = BasicObject.extend({
    constructor: <span class="keyword">function</span>(scope) {
      BasicObject.call(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>The scope used for this argument when calling the handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.scope = scope;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Routes currently in operative for this hash handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.routes = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Bind all for hashChanged</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.boundPopstate = _.bind(<span class="keyword">this</span>.popstate, <span class="keyword">this</span>);

      <span class="keyword">this</span>.enable();
    },

    go: <span class="keyword">function</span>(url, title) {
      window.history.pushState(<span class="literal">null</span>, title || window.document.title, url);
    },

    popstate: <span class="keyword">function</span>(e) {
      <span class="keyword">var</span> hash = <span class="keyword">this</span>.hash();
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.routes.length; i++) {
        <span class="keyword">var</span> route = <span class="keyword">this</span>.routes[i];

        <span class="keyword">this</span>.testRoute(hash, route);
      }
    },

    testRoute: <span class="keyword">function</span>(hash, route) {
      <span class="keyword">var</span> matches;
      <span class="keyword">if</span>(matches = route.matcher.regexp.exec(hash)) {
        <span class="keyword">if</span>(route.callback &amp;&amp; <span class="keyword">this</span>.enabled) {
          route.callback.apply(<span class="keyword">this</span>.scope, matches.slice(<span class="number">1</span>, matches.length));
        }

        <span class="keyword">return</span> <span class="literal">true</span>;
      }

      <span class="keyword">return</span> <span class="literal">false</span>;
    },

    generateMatcher: <span class="keyword">function</span>(route) {
      <span class="keyword">var</span> variableMatcher = <span class="string">"([A-Za-z0-9_\-]*)"</span>
          parts = route.split(<span class="string">"/"</span>),
          matcher = [],
          variables = <span class="number">0</span>

      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; parts.length; i++) {
        <span class="keyword">var</span> part = parts[i];
        <span class="keyword">if</span>(<span class="regexp">/:.*/</span>.test(part)) {
          matcher.push(variableMatcher);
          variables++;
        } <span class="keyword">else</span> {
          matcher.push(part);
        }
      }

      <span class="keyword">return</span> {
        variables: variables,
        regexp: <span class="keyword">new</span> RegExp(matcher.join(<span class="string">"/"</span>))
      }
    },

    getPathName: <span class="keyword">function</span>() {
      <span class="keyword">return</span> window.location.pathname;
    },

    hash: <span class="keyword">function</span>() {
      <span class="keyword">var</span> path = <span class="keyword">this</span>.getPathName();
      <span class="keyword">if</span>(path === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="string">''</span>;
      <span class="keyword">else</span> <span class="keyword">return</span> path;
    },

    <span class="comment">/* Route is another function for 'on' which scopes automatically */</span>
    route: <span class="keyword">function</span>(route, callback) {
      <span class="keyword">var</span> route = {
        matcher: <span class="keyword">this</span>.generateMatcher(route),
        callback: callback
      };
      <span class="keyword">this</span>.routes.push(route);

      <span class="keyword">this</span>.testRoute(<span class="keyword">this</span>.hash(), route);
    },

    disable: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.enabled = <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Remove event listener</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(window).off(<span class="string">'popstate'</span>, <span class="keyword">this</span>.boundPopstate);
      $(window).off(<span class="string">'pushstate'</span>, <span class="keyword">this</span>.boundPopstate);
    },

    enable: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.enabled = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Bind on hash change event on window to get notified once a hash has changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(window).on(<span class="string">'popstate'</span>, <span class="keyword">this</span>.boundPopstate);
      $(window).on(<span class="string">'pushstate'</span>, <span class="keyword">this</span>.boundPopstate);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Disables and removed all events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeAllRoutes: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.disable();
      <span class="keyword">this</span>.routes = [];
    },
  });

  <span class="comment">/*
   * Views
   */</span>

  <span class="comment">/*
   * Basic view
   */</span>
  <span class="function"><span class="keyword">function</span> <span class="title">splitEventSelector</span><span class="params">(selectorEvent)</span> {</span>
    <span class="keyword">var</span> s = {};
    <span class="keyword">if</span>(selectorEvent.indexOf(<span class="string">' '</span>) != -<span class="number">1</span>) {
      s.event = selectorEvent.substr(<span class="number">0</span>, selectorEvent.indexOf(<span class="string">' '</span>)),
      s.selector = selectorEvent.substr(selectorEvent.indexOf(<span class="string">' '</span>)+<span class="number">1</span>)
    } <span class="keyword">else</span> {
      s.event = selectorEvent;
    }

    <span class="keyword">return</span> s;
  }

  <span class="keyword">var</span> View = BasicObject.extend({
    subviews: [],
    tag: <span class="string">'div'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Basic view contstructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    constructor: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span>(!options) options = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Call the basic object&#39;s constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      BasicObject.call(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Set the element of the controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.el = options.el;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>set the tag of the controller (if specified)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(options.tag) <span class="keyword">this</span>.tag = options.tag;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Set the CSS classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.cssClass = options.cssClass;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Loop through the events if specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(<span class="keyword">this</span>.events) {
        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.events) {
          <span class="keyword">if</span>(<span class="keyword">this</span>.events.hasOwnProperty(key)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Bind the event to the view (including any sub-queries)
this.events[key] returns a function &#39;pointer&#39; (key)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>.on(key, <span class="keyword">this</span>[<span class="keyword">this</span>.events[key]]);
          }
        }
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Add a subview to the current view. Takes care of drawing the view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addSubview: <span class="keyword">function</span>(subview, options) {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Notify view it will be moved to a superview</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      subview.willMoveToSuperview(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Add the subview to this view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.subviews.push(subview);</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Set this as the super view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      subview.superView = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Draw the view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      subview.draw();</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>If the subview&#39;s el is present it latched on to something.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(!subview.el) {
        <span class="keyword">this</span>.$.append(subview.$);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Remove given view from this view. Takes care of unbinding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeSubview: <span class="keyword">function</span>(subview) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Get the index of the current view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> idx = <span class="keyword">this</span>.subviews.indexOf(subview);
      <span class="keyword">if</span>(idx !== -<span class="number">1</span>) {
        <span class="keyword">var</span> subview = <span class="keyword">this</span>.subviews[idx];
        <span class="keyword">delete</span> <span class="keyword">this</span>.subviews[idx];

        subview._wasRemovedFromSuperView();
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Easy function to remove a view of a super view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeFromSuperview: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(<span class="keyword">this</span>.superView) {
        <span class="keyword">this</span>.superView.removeSubview(<span class="keyword">this</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>On DOM event. Uses basic jQuery event handling.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    on: <span class="keyword">function</span>(event, cb) {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Try and split events such as &#39;click #selector&#39; and perform any find queries necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> eventSelector = splitEventSelector(event);
      <span class="keyword">var</span> callback = _.bind(cb, <span class="keyword">this</span>);
      <span class="keyword">if</span>(eventSelector.selector) {
        <span class="keyword">this</span>.$.on(eventSelector.event, eventSelector.selector, callback);

      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.$.on(eventSelector.event, callback);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Remove DOM event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    off: <span class="keyword">function</span>(event, cb) {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>If called without arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(event === <span class="literal">undefined</span>) {
        <span class="keyword">this</span>.$.off(); <span class="keyword">return</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Try and split events such as &#39;click #selector&#39; and perform any find queries necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> eventSelector = splitEventSelector(event);
      <span class="keyword">var</span> callback = _.bind(cb, <span class="keyword">this</span>);
      <span class="keyword">if</span>(eventSelector.selector) {
        <span class="keyword">this</span>.$.find(eventSelector.selector).off(eventSelector.event, callback);
      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.$.off(eventSelector.event, callback);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Function will be called when the view has been removed from the super view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _wasRemovedFromSuperView: <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Remove from DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.$.remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Unbind all event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.off();</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Call user defined unbinding handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(<span class="keyword">this</span>.wasRemovedFromSuperView!== <span class="literal">undefined</span>) <span class="keyword">this</span>.wasRemovedFromSuperView();
    },

    willMoveToSuperview: <span class="keyword">function</span>(){},</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Basic draw method. Should be overwritten for custom drawing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    draw: <span class="keyword">function</span>() {},
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Generic accessor for the view&#39;s element (either created or &#39;fetched&#39;).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Object.defineProperty(View.prototype, <span class="string">"$"</span>, {
    enumerable: <span class="literal">true</span>,

    get: <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Get the bound element or create a new element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> element = <span class="keyword">this</span>.el || <span class="string">'&lt;'</span>+<span class="keyword">this</span>.tag+<span class="string">'/&gt;'</span>;

      <span class="keyword">if</span>(!<span class="keyword">this</span>.__collection) {
        <span class="keyword">this</span>.__collection = $(element);</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Set the Frame view as &#39;data&#39; attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.__collection.data(<span class="string">'view'</span>, <span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Add classes set this view cssClass attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.__collection.addClass(<span class="keyword">this</span>.cssClass);
      }

      <span class="keyword">return</span> <span class="keyword">this</span>.__collection;
    }
  });

  <span class="comment">/*
   * Canvas view.
   */</span>
  <span class="keyword">var</span> CanvasView = View.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Create a canvas element if no element is given</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tag: <span class="string">'canvas'</span>,

    constructor: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span>(!options) options = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Call the super view&#39;s constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      View.call(<span class="keyword">this</span>, options);

      <span class="keyword">this</span>.$.attr({width: options.width, height: options.height});
      <span class="keyword">this</span>.context = <span class="keyword">this</span>.$[<span class="number">0</span>].getContext(<span class="string">'2d'</span>);
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Generic button view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Button = View.extend({
    tag: <span class="string">'button'</span>,

    constructor: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span>(!options) options = {};

      View.call(<span class="keyword">this</span>, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Initialize default text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(<span class="string">'text'</span> <span class="keyword">in</span> options) <span class="keyword">this</span>.text(options.text);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Convenient method to set the button&#39;s text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    text: <span class="keyword">function</span>(text) {
      <span class="keyword">this</span>.text = text;

      <span class="keyword">this</span>.draw();
    },

    draw: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.$.text(<span class="keyword">this</span>.text);
    },
  });

  <span class="comment">/*
   * Controllers
   */</span>

  <span class="keyword">var</span> ViewController = BasicObject.extend(
    [</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>The root view of this controller.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="string">'view'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Child view controllers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="string">'viewControllers'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Parent view controller or undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="string">'parentViewController'</span>], {
    constructor: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span>(!options) options = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Call the basic object&#39;s constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      BasicObject.call(<span class="keyword">this</span>);

      <span class="keyword">this</span>.el = options.el;
      <span class="keyword">this</span>.viewControllers = [];

    },

    loadView: <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Notify the inherited controller that the view is about to be loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.viewWillLoad();</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Create a new View and pass it the el (el may be undefined)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.view = <span class="keyword">new</span> View({el: <span class="keyword">this</span>.el, tag: <span class="keyword">this</span>.tag});</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Loop through the events if specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(<span class="keyword">this</span>.events) {
        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.events) {
          <span class="keyword">if</span>(<span class="keyword">this</span>.events.hasOwnProperty(key)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Bind the event to the view (including any sub-queries)
this.events[key] returns a function &#39;pointer&#39; (key)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>.on(key, <span class="keyword">this</span>[<span class="keyword">this</span>.events[key]]);
          }
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Notify the inherited controller that the view has been loaded and is ready.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.viewDidLoad();</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Return the view so that who ever called this function can add the DOM Nodes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> <span class="keyword">this</span>.view;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Add a child view controller. This method will take care of calling
the appropriate methods to load the child controllers view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addChildViewController: <span class="keyword">function</span>(controller) {
      <span class="keyword">if</span>(controller.parentViewController) {
        controller.removeFromParentViewController();
      }

      <span class="keyword">this</span>.viewControllers.push(controller);</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Set this as the parent view controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      controller.parentViewController = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Load the view of the child view controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.view.addSubview(controller.loadView());
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Remove a child view controller from the stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeChildViewController: <span class="keyword">function</span>(controller) {
      <span class="keyword">var</span> idx = <span class="keyword">this</span>.viewControllers.indexOf(controller);
      <span class="keyword">if</span>(idx != -<span class="number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Remove the view from the superview</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        conttroller.view.removeFromSuperview();

        controller.parentViewController = <span class="literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Remove the view controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.viewControllers.splice(idx, <span class="number">1</span>);
      }
    },

    removeFromParentViewController: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(<span class="keyword">this</span>.parentViewController) {
        <span class="keyword">this</span>.parentViewController.removeChildViewController(<span class="keyword">this</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>On DOM event. Uses basic jQuery event handling.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    on: <span class="keyword">function</span>(event, cb) {</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Try and split events such as &#39;click #selector&#39; and perform any find queries necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> eventSelector = splitEventSelector(event);
      <span class="keyword">var</span> callback = _.bind(cb, <span class="keyword">this</span>);
      <span class="keyword">if</span>(eventSelector.selector) {
        <span class="keyword">this</span>.view.$.on(eventSelector.event, eventSelector.selector, callback);

      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.view.$.on(eventSelector.event, callback);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Remove DOM event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    off: <span class="keyword">function</span>(event, cb) {</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>If called without arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(event === <span class="literal">undefined</span>) {
        <span class="keyword">this</span>.view.$.off(); <span class="keyword">return</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Try and split events such as &#39;click #selector&#39; and perform any find queries necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> eventSelector = splitEventSelector(event);
      <span class="keyword">var</span> callback = _.bind(cb, <span class="keyword">this</span>);
      <span class="keyword">if</span>(eventSelector.selector) {
        <span class="keyword">this</span>.view.$.find(eventSelector.selector).off(eventSelector.event, callback);
      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.view.$.off(eventSelector.event, callback);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Will be called when the view is done loading and is set up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    viewDidLoad:  <span class="keyword">function</span>(){},</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Will be called before any view loading is done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    viewWillLoad: <span class="keyword">function</span>(){},
  });
  Object.defineProperty(ViewController.prototype, <span class="string">'router'</span>, {
    enumerable: <span class="literal">true</span>,
    get: <span class="keyword">function</span>() {
      <span class="keyword">if</span>(<span class="keyword">this</span>._router === <span class="literal">undefined</span>) <span class="keyword">this</span>._router = <span class="keyword">new</span> Router(<span class="keyword">this</span>);

      <span class="keyword">return</span> <span class="keyword">this</span>._router;
    },
  });


  <span class="comment">/*
   * Basic DataStore. All New datastores inherit from this object
   */</span>
  <span class="keyword">var</span> DataStore = BasicObject.extend({
    open: <span class="keyword">function</span>(name, callback, options) {},
    destroy: <span class="keyword">function</span>(object, options) {},
    fetch: <span class="keyword">function</span>(object, parameters, options) {},
    add: <span class="keyword">function</span>(object, options) {},
    all: <span class="keyword">function</span>(collection, options) {},
  });

  <span class="comment">/*
   * Application class, root of the application stack.
   */</span>
  <span class="keyword">var</span> Application = BasicObject.extend({
    didFinishLoading: <span class="keyword">function</span>() {
      <span class="keyword">throw</span> Error(<span class="string">"didFinishLoading was not everwritten by subclass or Frame.Application was used directly as application class."</span>);
    },
    willTerminate: <span class="keyword">function</span>(){}
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Experimental collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> __emptyArray = [];
  <span class="keyword">var</span> CollectionPrototype = {
    forEach: __emptyArray.forEach,

    push: <span class="keyword">function</span>(object) {
      __emptyArray.push.call(<span class="keyword">this</span>, object);

      <span class="keyword">this</span>.trigger(<span class="string">'change'</span>, object);
    },

    clear: <span class="keyword">function</span>(arrayOrUndefined) {
      <span class="keyword">this</span>.length = <span class="number">0</span>;

      <span class="keyword">if</span>(arrayOrUndefined !== <span class="literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>We do not want to trigger a callback for each element
added if it&#39;s being observed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayOrUndefined.length; i++) {
          __emptyArray.push.call(<span class="keyword">this</span>, arrayOrUndefined[i]);
        }

        <span class="keyword">this</span>.trigger(<span class="string">'reset'</span>, <span class="keyword">this</span>);
      }

      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Same as clear</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    reset: <span class="keyword">function</span>(array) {<span class="keyword">return</span> <span class="keyword">this</span>.clear(array);},

    each: <span class="keyword">function</span>(callback, scope) {
      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) {
        callback.call(scope || <span class="keyword">this</span>, <span class="keyword">this</span>[i], i);
      }
    }
  };

  <span class="keyword">var</span> Collection = <span class="keyword">function</span>(array) {
    <span class="keyword">var</span> a;
    <span class="keyword">if</span>(array <span class="keyword">instanceof</span> Array) {
      a = array;
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Splat argument array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      a = Array.prototype.slice.call(arguments, <span class="number">0</span>);
    }

    <span class="keyword">if</span>(a.length &gt; <span class="number">0</span>) __emptyArray.push.apply(<span class="keyword">this</span>, a);
  }
  Collection.prototype = <span class="keyword">new</span> Array();
  _.extend(Collection.prototype, CollectionPrototype);
  _.extend(Collection.prototype, BasicObject.prototype);
  _.extend(Collection.prototype, EventTarget);</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Frame collection helper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Frame = <span class="keyword">function</span>(a) {
    <span class="keyword">if</span>(!(a <span class="keyword">instanceof</span> Array)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Set a to arguments if it&#39;s not an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      a = Array.prototype.slice.call(arguments, <span class="number">0</span>);
    }

    <span class="keyword">return</span> VariableConstructor(Collection, a);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Frame configuration options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.config = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.BasicObject = BasicObject;
  Frame.NotificationCenter = NotificationCenter;
  Frame.Model = Model;
  Frame.Router = Router;
  Frame.Collection = Collection;</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Expose Frame&#39;s &#39;EventTarget&#39; implementation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.EventTarget = EventTarget;</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.View = View;
  Frame.CanvasView = CanvasView;
  Frame.Button = Button;</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Controllers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.ViewController = ViewController;

  Frame.DataStore = DataStore;
  Frame.defaultStore = <span class="literal">undefined</span>;

  Frame.Application = Application;</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Frame.createDefaultInstanceMethodOn = createDefaultInstanceMethodOn;
  Frame.has = __has;
  Frame.keys = __keys;
  Frame.makeArray = __makeArray;
  Frame.isBasicObject = __isBasicObject;
  Frame.gid = __gid;

  Frame.VERSION = __version;

  <span class="comment">/*
   * Frame (private) boot strap functions
   */</span>
  <span class="function"><span class="keyword">function</span> <span class="title">BootstrapDatabase</span><span class="params">(onReady)</span> {</span>
    <span class="keyword">if</span>(Frame.config.db) {
      <span class="keyword">var</span> db = Frame.config.db;</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Indexeddb store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span>(db.type === <span class="string">'Frame.IndexedStore'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Initialize the data store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> store = <span class="keyword">new</span> Frame.IndexedStore();</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Set the default store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Frame.defaultStore = store;</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Set the definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Frame.defaultStore.definition = db.definition;</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Open database and call the onReady when ever it&#39;s done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        store.open(db.name, onReady, db);
      }
    } <span class="keyword">else</span> { <span class="comment">/* If no database continue initializing */</span>
      onReady();
    }
  }

  <span class="function"><span class="keyword">function</span> <span class="title">FrameBootstrapFramework</span><span class="params">(options)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Bootstrap database (if any)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    BootstrapDatabase(options.onReady);
  }

  <span class="comment">/*
   * Define the application accessor.
   * Once the application property is set it will use it to create
   * a new instance of that object and uses that as the root of your application.
   */</span>
  Object.defineProperty(Frame, <span class="string">'application'</span>, {
    set: <span class="keyword">function</span>(ApplicationObject) {
      <span class="keyword">var</span> app;</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Create a new application instance from the given application class.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      app = <span class="keyword">new</span> ApplicationObject();</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Set Frame&#39;s application instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">this</span>.applicationInstance = app;

      FrameBootstrapFramework({
        onReady: <span class="keyword">function</span>() {
          app.didFinishLaunching();</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>If a rootViewController is set call the conrollers loadView method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">if</span>(app.rootViewController) {</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Set the body if no element has been set on the root controller.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span>(!app.rootViewController.el) app.rootViewController.el = <span class="string">'body'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Load the view and draw it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> view = app.rootViewController.loadView();
            view.draw();
          }
        }
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Set up the terminate callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(window).on(<span class="string">'beforeunload'</span>, <span class="keyword">function</span>() {
        app.willTerminate();
      });
    },
  });

  window.Frame = Frame;</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Register AMD module.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) {
    define(<span class="string">"frame.core"</span>, [], <span class="keyword">function</span>() { <span class="keyword">return</span> Frame; });
  }
})(window);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
